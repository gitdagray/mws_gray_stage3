async function sendNewReview(){try{let e=self.restaurant.id,t=document.getElementById("newRevName").value,n=document.getElementById("newRevRating").value,a=document.getElementById("newRevComments").value;const r=await fetch("http://localhost:1337/reviews/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({restaurant_id:e,name:t,rating:n,comments:a})}),o=await r.json();console.log("myRevReply: "+JSON.stringify(o)),showReviewThankYou(t)}catch(e){console.log("Post failed."),console.error(e)}}let restaurant,reviews;var map;"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(){console.log("Service Worker Registered!")}).catch(e=>{console.log(e)}),window.addEventListener("offline",function(e){console.log("offline"),console.log(e)}),window.addEventListener("online",function(e){console.log("online"),console.log("now online: sending new faves"),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)}),console.log("now online: sending new reviews"),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)})}),window.addEventListener("sendFave",function(e){console.log("immediate: sending new fave"),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)})}),window.addEventListener("sendRev",function(e){console.log("immediate: sending new review"),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)})}),getFullDate=(e=>{const t=new Date(e);return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()}),document.getElementById("map-link").addEventListener("click",e=>{document.getElementById("map-link-option").style.display="none";document.getElementById("map-container").style.display="block"}),window.onload=(()=>{({width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight}).width>800&&document.getElementById("map-link").click(),console.log("looking in idb for faves..."),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)}),console.log("looking in idb for reviews..."),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)}),fetchRestaurantFromURL((e,t)=>{e?console.error(e):(fillBreadcrumb(),initMap(t),fetchRestaurantReviewsFromURL((e,t)=>{e&&console.error(e)}))})}),window.initMap=(e=>{const t=document.getElementById("map"),n=document.createAttribute("src"),a=document.createAttribute("alt"),r=document.createAttribute("tabindex"),o=e.latlng.lat+","+e.latlng.lng;let i="https://maps.googleapis.com/maps/api/staticmap?center=";i=(i=i+o+"&zoom=16&size=320x320&scale=1&markers=color:red%7C")+o+"&key=AIzaSyA8iJ1AVyPPTXTKUDzwY8jrB04Ndhdxy0Q",n.value=i,a.value="A map for "+e.name,r.value=0,t.setAttributeNode(n),t.setAttributeNode(a),t.setAttributeNode(r)}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("headline-holder");document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("like-button-holder"),n=!(!e.is_favorite||"true"!==e.is_favorite.toString()),a=document.createElement("button");a.className="fave-rest-icon";const r=document.createAttribute("tabindex");r.value=0,a.setAttributeNode(r);const o=document.createAttribute("aria-label");o.value=n?e.name+" is a favorite.":e.name+" is not a favorite.",a.setAttributeNode(o),a.id="fave-rest-icon-"+e.id,a.style.background=n?'url("img/icons/like.svg") no-repeat':'url("img/icons/like-not.svg") no-repeat',a.onclick=(t=>handleLikeButtonClick(e.id,!n)),t.append(a);const i=document.getElementById("restaurant-address");i.innerHTML=e.address;const d=document.createAttribute("aria-label");d.value="The address for "+e.name+" is "+e.address+".",i.setAttributeNode(d);const l=document.getElementById("restaurant-img");l.className="restaurant-img",l.src=DBHelper.imageUrlForRestaurant(e)+"_800.jpg",l.sizes="(max-width: 400px) 100vw, (min-width: 401px) 50vw",l.srcset=DBHelper.imageUrlForRestaurant(e)+"_400.jpg 400w, "+DBHelper.imageUrlForRestaurant(e)+"_800.jpg 800w",l.title=e.name,l.alt="Image of the "+e.name+" restaurant.";const u=document.getElementById("restaurant-cuisine");u.innerHTML=e.cuisine_type;const c=document.createAttribute("aria-label");c.value="Cuisine type of "+e.name+" is "+e.cuisine_type+".",u.setAttributeNode(c),e.operating_hours&&fillRestaurantHoursHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("th");r.innerHTML=n;const o=document.createAttribute("scope"),i=document.createAttribute("tabindex");o.value="row",i.value=0,r.setAttributeNode(o),r.setAttributeNode(i),a.appendChild(r);const d=document.createElement("td"),l=document.createAttribute("tabindex");d.innerHTML=e[n],l.value=0,d.setAttributeNode(l),a.appendChild(d),t.appendChild(a)}}),fetchRestaurantReviewsFromURL=(e=>{if(self.reviews)return void e(null,self.reviews);const t=self.restaurant.id;t?DBHelper.fetchReviewsByRestaurantId(t,(t,n)=>{self.reviews=n,n?(fillReviewsHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3"),a=document.createAttribute("tabindex");n.innerHTML="Reviews",a.value=0,n.setAttributeNode(a),t.appendChild(n);const r=document.createElement("button");r.innerHTML="Add A New Review for<br>"+self.restaurant.name;const o=document.createAttribute("id"),i=document.createAttribute("tabindex"),d=document.createAttribute("aria-label");o.value="new-review-button",i.value=0,d.value="Press button to add a new review for "+self.restaurant.name,r.setAttributeNode(o),r.setAttributeNode(i),r.setAttributeNode(d),t.appendChild(r);const l=document.createElement("form"),u=document.createAttribute("id"),c=document.createAttribute("name"),s=document.createAttribute("onsubmit");u.value="new-review-form",c.value="newReviewForm",s.value="validateNewReview()",l.setAttributeNode(u),l.setAttributeNode(u),l.setAttributeNode(c),t.appendChild(l);const m=document.getElementById("new-review-form"),v=document.createElement("p"),b=document.createAttribute("tabindex"),A=document.createAttribute("id");b.value=0,A.value="thankYou",v.setAttributeNode(b),v.setAttributeNode(A),t.appendChild(v);const w=document.createElement("label");w.innerHTML="Please enter your name:";const g=document.createAttribute("id"),p=document.createAttribute("for");g.value="newRevNameLabel",p.value="newRevName",w.setAttributeNode(g),w.setAttributeNode(p),m.appendChild(w);const h=document.createElement("input"),f=document.createAttribute("tabindex"),N=document.createAttribute("id"),y=document.createAttribute("aria-labelledby"),R=document.createAttribute("type"),E=document.createAttribute("name"),L=document.createAttribute("placeholder"),B=document.createAttribute("maxlength"),C=document.createAttribute("required");f.value=0,N.value="newRevName",y.value="newRevNameLabel",R.value="text",E.value="revname",L.value="Your Name",B.value=20,h.setAttributeNode(f),h.setAttributeNode(N),h.setAttributeNode(y),h.setAttributeNode(R),h.setAttributeNode(E),h.setAttributeNode(L),h.setAttributeNode(B),h.setAttributeNode(C),m.appendChild(h);const k=document.createElement("label");k.innerHTML="Please choose a rating:";const H=document.createAttribute("id"),T=document.createAttribute("for");H.value="newRevRatingLabel",T.value="newRevRating",k.setAttributeNode(H),k.setAttributeNode(T),m.appendChild(k);const I=document.createElement("select"),M=document.createAttribute("tabindex"),x=document.createAttribute("id"),D=document.createAttribute("name"),F=document.createAttribute("aria-labelledby");M.value=0,x.value="newRevRating",D.value="newRevRating",F.value="newRevRatingLabel",I.setAttributeNode(M),I.setAttributeNode(x),I.setAttributeNode(D),I.setAttributeNode(F),m.appendChild(I);const _=document.getElementById("newRevRating"),U=document.createElement("option"),P=document.createElement("option"),Y=document.createElement("option"),j=document.createElement("option"),S=document.createElement("option");U.innerHTML="5: Awesome!",P.innerHTML="4: Above Average",Y.innerHTML="3: Average",j.innerHTML="2: Below Average",S.innerHTML="1: Awful";const W=document.createAttribute("value"),z=document.createAttribute("value"),J=document.createAttribute("value"),O=document.createAttribute("value"),$=document.createAttribute("value"),q=document.createAttribute("selected");W.value=5,z.value=4,J.value=3,O.value=2,$.value=1,U.setAttributeNode(W),U.setAttributeNode(q),P.setAttributeNode(z),Y.setAttributeNode(J),j.setAttributeNode(O),S.setAttributeNode($),_.appendChild(U),_.appendChild(P),_.appendChild(Y),_.appendChild(j),_.appendChild(S);const K=document.createElement("label");K.innerHTML="Review Comments:";const Q=document.createAttribute("id"),V=document.createAttribute("for");Q.value="newRevCommentsLabel",V.value="newRevComments",K.setAttributeNode(Q),K.setAttributeNode(V),m.appendChild(K);const X=document.createElement("textarea"),G=document.createAttribute("tabindex"),Z=document.createAttribute("id"),ee=document.createAttribute("aria-labelledby"),te=document.createAttribute("name"),ne=document.createAttribute("maxlength");G.value=0,Z.value="newRevComments",ee.value="newRevCommentsLabel",te.value="revcomments",ne.value=250,X.setAttributeNode(G),X.setAttributeNode(Z),X.setAttributeNode(ee),X.setAttributeNode(te),X.setAttributeNode(ne),m.appendChild(X);const ae=document.createElement("button");ae.innerHTML="Submit A New Review for<br>"+self.restaurant.name;const re=document.createAttribute("id"),oe=document.createAttribute("tabindex"),ie=document.createAttribute("aria-label");if(re.value="sub-review-button",oe.value=0,ie.value="Press this button to add a new review for "+self.restaurant.name,ae.setAttributeNode(re),ae.setAttributeNode(oe),ae.setAttributeNode(ie),m.appendChild(ae),document.getElementById("new-review-button").addEventListener("click",()=>{document.getElementById("new-review-form").style.display="block",document.getElementById("new-review-button").style.display="none"}),document.getElementById("new-review-form").addEventListener("submit",e=>{e.preventDefault();const t=self.restaurant.id,n=document.getElementById("newRevName").value,a=document.getElementById("newRevRating").value,r=document.getElementById("newRevComments").value;"serviceWorker"in navigator?navigator.serviceWorker.ready.then(e=>{const o={restaurant_id:t,name:n,rating:a,comments:r};console.log("newReviewData: "+JSON.stringify(o)),writeData("sync-newRev",o).then(showReviewThankYou(n)).catch(e=>console.log(e))}).then(()=>{if(navigator.onLine){var e=new Event("sendRev");window.dispatchEvent(e)}}):sendNewReview()}),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const de=document.getElementById("reviews-list");e.forEach(e=>{de.appendChild(createReviewHTML(e))}),t.appendChild(de)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("div"),a=document.createAttribute("class"),r=document.createAttribute("aria-label"),o=document.createAttribute("tabindex");n.innerHTML=e.name,a.value="review-name",r.value="Review by "+e.name+".",o.value=0,n.setAttributeNode(a),n.setAttributeNode(r),n.setAttributeNode(o),t.appendChild(n);const i=document.createElement("div"),d=document.createAttribute("class"),l=document.createAttribute("aria-label"),u=document.createAttribute("tabindex"),c=getFullDate(e.updatedAt);i.innerHTML=c,d.value="review-date",l.value="Review posted on "+c+".",u.value=0,i.setAttributeNode(d),i.setAttributeNode(l),i.setAttributeNode(u),t.appendChild(i);const s=document.createElement("div"),m=document.createAttribute("class"),v=document.createAttribute("aria-label"),b=document.createAttribute("tabindex");s.innerHTML=`Rating: ${e.rating}`,m.value="review-rating",v.value=e.name+" gave a rating of "+e.rating+".",b.value=0,s.setAttributeNode(m),s.setAttributeNode(v),s.setAttributeNode(b),t.appendChild(s);const A=document.createElement("p"),w=document.createAttribute("class"),g=document.createAttribute("tabindex");return A.innerHTML=e.comments,w.value="review-comments",g.value=0,A.setAttributeNode(w),A.setAttributeNode(g),t.appendChild(A),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),showReviewThankYou=(e=>{document.getElementById("thankYou").innerHTML="Thank you for submitting a review "+e+"!",document.getElementById("thankYou").style.display="block",document.getElementById("new-review-form").style.display="none"}),handleLikeButtonClick=((e,t)=>{const n=document.getElementById("fave-rest-icon-"+e);self.restaurant.is_favorite=t,n.style.background=t?'url("img/icons/like.svg") no-repeat':'url("img/icons/like-not.svg") no-repeat',t?n.setAttribute("aria-label",self.restaurant.name+" is a favorite."):n.setAttribute("aria-label",self.restaurant.name+" is not a favorite."),n.onclick=(n=>handleLikeButtonClick(e,!t)),handleFaveClick(e,t)});