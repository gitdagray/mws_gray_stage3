async function sendNewReview(){try{let e=self.restaurant.id,t=document.getElementById("newRevName").value,n=document.getElementById("newRevRating").value,a=document.getElementById("newRevComments").value;const r=await fetch("http://localhost:1337/reviews/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({restaurant_id:e,name:t,rating:n,comments:a})}),o=await r.json();console.log("myRevReply: "+JSON.stringify(o)),showReviewThankYou(t)}catch(e){console.log("Post failed."),console.error(e)}}let restaurant,reviews;var map;"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(function(){console.log("Service Worker Registered!")}).catch(e=>{console.log(e)}),window.addEventListener("offline",function(e){console.log("offline"),console.log(e)}),window.addEventListener("online",function(e){console.log("online"),console.log("now online: sending new faves"),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)}),console.log("now online: sending new reviews"),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)})}),window.addEventListener("sendFave",function(e){console.log("immediate: sending new fave"),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)})}),window.addEventListener("sendRev",function(e){console.log("immediate: sending new review"),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)})}),getFullDate=(e=>{const t=new Date(e);return t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear()}),document.getElementById("map-link").addEventListener("click",e=>{document.getElementById("map-link-option").style.display="none";document.getElementById("map-container").style.display="block"}),mapDecisions=(()=>{({width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight}).width>800&&document.getElementById("map-link").click(),initMap(),console.log("looking in idb for faves..."),readAllData("sync-newFav").then(e=>favEm(e)).catch(e=>{console.log("Fave send failed"),console.error(e)}),console.log("looking in idb for reviews..."),readAllData("sync-newRev").then(e=>postEm(e)).catch(e=>{console.log("Review send failed"),console.error(e)})}),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map),google.maps.event.addListenerOnce(map,"idle",()=>{document.getElementsByTagName("iframe")[0].title="Google Maps"}))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("headline-holder");document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("like-button-holder"),n=!(!e.is_favorite||"true"!==e.is_favorite.toString()),a=document.createElement("button");a.className="fave-rest-icon";const r=document.createAttribute("tabindex");r.value=0,a.setAttributeNode(r);const o=document.createAttribute("aria-label");o.value=n?e.name+" is a favorite.":e.name+" is not a favorite.",a.setAttributeNode(o),a.id="fave-rest-icon-"+e.id,a.style.background=n?'url("img/icons/like.svg") no-repeat':'url("img/icons/like-not.svg") no-repeat',a.onclick=(t=>handleLikeButtonClick(e.id,!n)),t.append(a);const i=document.getElementById("restaurant-address");i.innerHTML=e.address;const l=document.createAttribute("aria-label");l.value="The address for "+e.name+" is "+e.address+".",i.setAttributeNode(l);const d=document.getElementById("restaurant-img");d.className="restaurant-img",d.src=DBHelper.imageUrlForRestaurant(e)+"_800.jpg",d.sizes="(max-width: 400px) 100vw, (min-width: 401px) 50vw",d.srcset=DBHelper.imageUrlForRestaurant(e)+"_400.jpg 400w, "+DBHelper.imageUrlForRestaurant(e)+"_800.jpg 800w",d.title=e.name,d.alt="Image of the "+e.name+" restaurant.";const u=document.getElementById("restaurant-cuisine");u.innerHTML=e.cuisine_type;const c=document.createAttribute("aria-label");c.value="Cuisine type of "+e.name+" is "+e.cuisine_type+".",u.setAttributeNode(c),e.operating_hours&&fillRestaurantHoursHTML(),fetchRestaurantReviewsFromURL()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const a=document.createElement("tr"),r=document.createElement("th");r.innerHTML=n;const o=document.createAttribute("scope"),i=document.createAttribute("tabindex");o.value="row",i.value=0,r.setAttributeNode(o),r.setAttributeNode(i),a.appendChild(r);const l=document.createElement("td"),d=document.createAttribute("tabindex");l.innerHTML=e[n],d.value=0,l.setAttributeNode(d),a.appendChild(l),t.appendChild(a)}}),fetchRestaurantReviewsFromURL=(e=>{if(self.reviews)return void e(null,self.reviews);const t=self.restaurant.id;t?DBHelper.fetchReviewsByRestaurantId(t,(e,t)=>{t?(self.reviews=t,fillReviewsHTML()):console.error(e)}):(error="No restaurant id in URL",e(error,null))}),fillReviewsHTML=((e=self.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h3"),a=document.createAttribute("tabindex");n.innerHTML="Reviews",a.value=0,n.setAttributeNode(a),t.appendChild(n);const r=document.createElement("button");r.innerHTML="Add A New Review for<br>"+self.restaurant.name;const o=document.createAttribute("id"),i=document.createAttribute("tabindex"),l=document.createAttribute("aria-label");o.value="new-review-button",i.value=0,l.value="Press button to add a new review for "+self.restaurant.name,r.setAttributeNode(o),r.setAttributeNode(i),r.setAttributeNode(l),t.appendChild(r);const d=document.createElement("form"),u=document.createAttribute("id"),c=document.createAttribute("name"),s=document.createAttribute("onsubmit");u.value="new-review-form",c.value="newReviewForm",s.value="validateNewReview()",d.setAttributeNode(u),d.setAttributeNode(u),d.setAttributeNode(c),t.appendChild(d);const m=document.getElementById("new-review-form"),v=document.createElement("p"),b=document.createAttribute("tabindex"),w=document.createAttribute("id");b.value=0,w.value="thankYou",v.setAttributeNode(b),v.setAttributeNode(w),t.appendChild(v);const A=document.createElement("label");A.innerHTML="Please enter your name:";const g=document.createAttribute("id"),p=document.createAttribute("for");g.value="newRevNameLabel",p.value="newRevName",A.setAttributeNode(g),A.setAttributeNode(p),m.appendChild(A);const f=document.createElement("input"),h=document.createAttribute("tabindex"),R=document.createAttribute("id"),N=document.createAttribute("aria-labelledby"),y=document.createAttribute("type"),E=document.createAttribute("name"),L=document.createAttribute("placeholder"),B=document.createAttribute("maxlength"),C=document.createAttribute("required");h.value=0,R.value="newRevName",N.value="newRevNameLabel",y.value="text",E.value="revname",L.value="Your Name",B.value=20,f.setAttributeNode(h),f.setAttributeNode(R),f.setAttributeNode(N),f.setAttributeNode(y),f.setAttributeNode(E),f.setAttributeNode(L),f.setAttributeNode(B),f.setAttributeNode(C),m.appendChild(f);const H=document.createElement("label");H.innerHTML="Please choose a rating:";const k=document.createAttribute("id"),T=document.createAttribute("for");k.value="newRevRatingLabel",T.value="newRevRating",H.setAttributeNode(k),H.setAttributeNode(T),m.appendChild(H);const M=document.createElement("select"),I=document.createAttribute("tabindex"),x=document.createAttribute("id"),D=document.createAttribute("name"),F=document.createAttribute("aria-labelledby");I.value=0,x.value="newRevRating",D.value="newRevRating",F.value="newRevRatingLabel",M.setAttributeNode(I),M.setAttributeNode(x),M.setAttributeNode(D),M.setAttributeNode(F),m.appendChild(M);const _=document.getElementById("newRevRating"),U=document.createElement("option"),P=document.createElement("option"),Y=document.createElement("option"),j=document.createElement("option"),S=document.createElement("option");U.innerHTML="5: Awesome!",P.innerHTML="4: Above Average",Y.innerHTML="3: Average",j.innerHTML="2: Below Average",S.innerHTML="1: Awful";const W=document.createAttribute("value"),O=document.createAttribute("value"),$=document.createAttribute("value"),J=document.createAttribute("value"),z=document.createAttribute("value"),q=document.createAttribute("selected");W.value=5,O.value=4,$.value=3,J.value=2,z.value=1,U.setAttributeNode(W),U.setAttributeNode(q),P.setAttributeNode(O),Y.setAttributeNode($),j.setAttributeNode(J),S.setAttributeNode(z),_.appendChild(U),_.appendChild(P),_.appendChild(Y),_.appendChild(j),_.appendChild(S);const G=document.createElement("label");G.innerHTML="Review Comments:";const K=document.createAttribute("id"),Q=document.createAttribute("for");K.value="newRevCommentsLabel",Q.value="newRevComments",G.setAttributeNode(K),G.setAttributeNode(Q),m.appendChild(G);const V=document.createElement("textarea"),X=document.createAttribute("tabindex"),Z=document.createAttribute("id"),ee=document.createAttribute("aria-labelledby"),te=document.createAttribute("name"),ne=document.createAttribute("maxlength");X.value=0,Z.value="newRevComments",ee.value="newRevCommentsLabel",te.value="revcomments",ne.value=250,V.setAttributeNode(X),V.setAttributeNode(Z),V.setAttributeNode(ee),V.setAttributeNode(te),V.setAttributeNode(ne),m.appendChild(V);const ae=document.createElement("button");ae.innerHTML="Submit A New Review for<br>"+self.restaurant.name;const re=document.createAttribute("id"),oe=document.createAttribute("tabindex"),ie=document.createAttribute("aria-label");if(re.value="sub-review-button",oe.value=0,ie.value="Press this button to add a new review for "+self.restaurant.name,ae.setAttributeNode(re),ae.setAttributeNode(oe),ae.setAttributeNode(ie),m.appendChild(ae),document.getElementById("new-review-button").addEventListener("click",()=>{document.getElementById("new-review-form").style.display="block",document.getElementById("new-review-button").style.display="none"}),document.getElementById("new-review-form").addEventListener("submit",e=>{e.preventDefault();const t=self.restaurant.id,n=document.getElementById("newRevName").value,a=document.getElementById("newRevRating").value,r=document.getElementById("newRevComments").value;"serviceWorker"in navigator?navigator.serviceWorker.ready.then(e=>{const o={restaurant_id:t,name:n,rating:a,comments:r};console.log("newReviewData: "+JSON.stringify(o)),writeData("sync-newRev",o).then(showReviewThankYou(n)).catch(e=>console.log(e))}).then(()=>{if(navigator.onLine){var e=new Event("sendRev");window.dispatchEvent(e)}}):sendNewReview()}),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const le=document.getElementById("reviews-list");e.forEach(e=>{le.appendChild(createReviewHTML(e))}),t.appendChild(le)}),createReviewHTML=(e=>{const t=document.createElement("li"),n=document.createElement("div"),a=document.createAttribute("class"),r=document.createAttribute("aria-label"),o=document.createAttribute("tabindex");n.innerHTML=e.name,a.value="review-name",r.value="Review by "+e.name+".",o.value=0,n.setAttributeNode(a),n.setAttributeNode(r),n.setAttributeNode(o),t.appendChild(n);const i=document.createElement("div"),l=document.createAttribute("class"),d=document.createAttribute("aria-label"),u=document.createAttribute("tabindex"),c=getFullDate(e.updatedAt);i.innerHTML=c,l.value="review-date",d.value="Review posted on "+c+".",u.value=0,i.setAttributeNode(l),i.setAttributeNode(d),i.setAttributeNode(u),t.appendChild(i);const s=document.createElement("div"),m=document.createAttribute("class"),v=document.createAttribute("aria-label"),b=document.createAttribute("tabindex");s.innerHTML=`Rating: ${e.rating}`,m.value="review-rating",v.value=e.name+" gave a rating of "+e.rating+".",b.value=0,s.setAttributeNode(m),s.setAttributeNode(v),s.setAttributeNode(b),t.appendChild(s);const w=document.createElement("p"),A=document.createAttribute("class"),g=document.createAttribute("tabindex");return w.innerHTML=e.comments,A.value="review-comments",g.value=0,w.setAttributeNode(A),w.setAttributeNode(g),t.appendChild(w),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),showReviewThankYou=(e=>{document.getElementById("thankYou").innerHTML="Thank you for submitting a review "+e+"!",document.getElementById("thankYou").style.display="block",document.getElementById("new-review-form").style.display="none"}),handleLikeButtonClick=((e,t)=>{const n=document.getElementById("fave-rest-icon-"+e);self.restaurant.is_favorite=t,n.style.background=t?'url("img/icons/like.svg") no-repeat':'url("img/icons/like-not.svg") no-repeat',t?n.setAttribute("aria-label",self.restaurant.name+" is a favorite."):n.setAttribute("aria-label",self.restaurant.name+" is not a favorite."),n.onclick=(n=>handleLikeButtonClick(e,!t)),handleFaveClick(e,t)});